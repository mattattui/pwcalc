<!DOCTYPE html>

<html lang="en" manifest="pwcalc.appcache">
<head>
  <meta http-equiv="Content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <title>Password calculator</title>
  <script src="passhash.js" type="text/javascript" charset="utf-8"></script>

  <script src="hmac-sha1.js" type="text/javascript" charset="utf-8"></script>
  <script src="enc-base64-min.js" type="text/javascript" charset="utf-8"></script>
  
  <style type="text/css" media="screen">
  body
  {
    background: #333;
    color: #ccc;
    font-family: sans-serif;
  }
  a,a:link
  {
    color: #6cf;
  }
  h1
  {
    color: #fff;
  }
  input[type=text],
  input[type=password]
  {
    width: 280px;
    margin-bottom: 1.5em;
  }
  input[type=radio]
  {
    margin-right: 1.5em;
  }
  #password
  {
    font-family: monospace;
    margin-bottom: 1.5em;
    min-height: 1.5em;
    border: 1px solid #666;
    padding: 0.5em;
  }
  li
  {
    margin-bottom: .5em;
  }
  </style>
</head>
<body>
  
  <h1>Password calculator</h1>
  
  <form action="#" id="pwform" method="post">
    <p>
      <label for="site">Site</label><br><input type="text" name="site" value="" id="site" placeholder="e.g. google"><br>
      <label for="passphrase">Master passphrase</label><br><input type="password" name="passphrase" value="" id="passphrase"><br>
      
      <p><label for="special">Include special characters</label> <input type="checkbox" name="specialchars" value="1" id="special" checked></p>
      
      <strong>Length:</strong><br>
      <label for="length8">8</label><input type="radio" name="pwlength" value="8" id="length8">
      <label for="length12">12</label><input type="radio" name="pwlength" value="12" id="length12">
      <label for="length16">16</label><input type="radio" name="pwlength" value="16" id="length16" checked>
      <input type="submit" name="calculate" value="Calculate" id="calculate"><br>
    </p>
  </form>
  
  <div class="outputTitle">Calculated password:</div>
  <div id="password">&nbsp;</div>
  
  
  <p>Notes:</p>
  <ul>
    <li>The point of this is to make unique, hard-to-guess passwords for websites, which you don't have to remember yourself. You only have to remember your master passphrase, which you can use as often as you like. If the site you're using is hacked and the passwords stolen, the password can't be used to get into any of your other accounts. </li>
    <li>Use the longest generated password that the site allows.</li>
    <li>Passwords are calculated in your browser, never sent over the network.</li>
    <li>If you want help picking a passphrase, try <a href="http://passphra.se/" title="passphra.se - Generate long, easy-to-remember passwords">http://passphra.se/</a> which is based on this <a href="http://xkcd.com/936/" title="xkcd: Password Strength">XKCD comic strip</a>.</li>
    <li>"Site" is just a suggestion. You can type anything you like.</li>
    <li>This isn't 100% safe. In fact I don't make any guarantees at all. I am not a cryptographer. Your browser might be hacked. You could be living in a simulation.</li>
    <li>The output is a Base64 representation of the SHA1 HMAC of <kdb>site</kdb> encrypted with <kbd>passphrase</kbd>, truncated to the length requested</li>
    <li>The <a href="https://github.com/inanimatt/pwcalc">source is on GitHub</a>. Fork it, fix it, make a pull request. I'll love you for it.</li>
  </ul>
  
  <script type="text/javascript" charset="utf-8">
  function b64_hmac_sha1(key, data) {
    var out = CryptoJS.HmacSHA1(data, key).toString(CryptoJS.enc.Base64);
    // PassHash expects a Base64 without padding characters
    while (out.substr(-1) == '=') {
      out = out.substr(0,out.length-1);
    }
    return out;
  }


  window.addEventListener('load', function (){

    var form = document.getElementById('pwform');
    
    form.addEventListener('submit', function (e){
      e.preventDefault(); // Don't actually submit the form

      var data = document.getElementById('site').value;
      var passphrase = document.getElementById('passphrase').value;
      var restrictSpecial = ! document.getElementById('special').checked;

      var length = 16;
      if (document.getElementById('length12').checked) {
        length = 12;
      } else if (document.getElementById('length8').checked) {
        length = 8;
      }
      
      var hash = PassHashCommon.generateHashWord(data, passphrase, length, true, true, true, restrictSpecial, false);

      document.getElementById('password').innerText = hash.substr(0,length);

      return false;
    });

  });
    
  </script>
</body>
</html>